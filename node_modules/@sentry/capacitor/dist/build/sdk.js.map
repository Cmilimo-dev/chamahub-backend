{"version":3,"file":"sdk.js","sourceRoot":"","sources":["../../src/sdk.ts"],"names":[],"mappings":"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","sourcesContent":["import type { BrowserOptions } from '@sentry/browser';\nimport { init as browserInit } from '@sentry/browser';\nimport type { Integration } from '@sentry/core';\nimport { getClient, getGlobalScope, getIntegrationsToSetup, getIsolationScope , logger } from '@sentry/core';\n\nimport { getDefaultIntegrations } from './integrations/default';\nimport type { CapacitorClientOptions, CapacitorOptions } from './options';\nimport { enableSyncToNative } from './scopeSync';\nimport { useEncodePolyfill } from './transports/encodePolyfill';\nimport { DEFAULT_BUFFER_SIZE, makeNativeTransport } from './transports/native';\nimport { safeFactory } from './utils/safeFactory';\nimport { IsTextEncoderAvailable } from './utils/textEncoder';\nimport { NATIVE } from './wrapper';\n\n/**\n * Initializes the Capacitor SDK alongside a sibling Sentry SDK\n * @param options Options for the SDK\n * @param originalInit The init function of the sibling SDK, leave blank to initialize with `@sentry/browser`\n */\nexport function init<T>(\n  passedOptions: CapacitorOptions & T,\n  originalInit: (passedOptions: T & BrowserOptions) => void = browserInit,\n): void {\n  const finalOptions = {\n    enableAutoSessionTracking: true,\n    enableWatchdogTerminationTracking: true,\n    enableCaptureFailedRequests: false,\n    ...passedOptions,\n  };\n  if (finalOptions.enabled === false || NATIVE.platform === 'web') {\n    finalOptions.enableNative = false;\n    finalOptions.enableNativeNagger = false;\n  } else {\n    // keep the original value if user defined it.\n    finalOptions.enableNativeNagger ??= true;\n    finalOptions.enableNative ??= true;\n  }\n  //  const capacitorHub = new Hub(undefined, new CapacitorScope());\n  //  makeMain(capacitorHub);\n  const defaultIntegrations: false | Integration[] =\n    passedOptions.defaultIntegrations === undefined\n      ? getDefaultIntegrations(passedOptions)\n      : passedOptions.defaultIntegrations;\n\n  finalOptions.integrations = getIntegrationsToSetup({\n    integrations: safeFactory(passedOptions.integrations, {\n      loggerMessage: 'The integrations threw an error',\n    }),\n    defaultIntegrations,\n  });\n\n  if (\n    finalOptions.enableNative &&\n    !passedOptions.transport &&\n    NATIVE.platform !== 'web'\n  ) {\n    finalOptions.transport = passedOptions.transport || makeNativeTransport;\n\n    finalOptions.transportOptions = {\n      ...(passedOptions.transportOptions ?? {}),\n      bufferSize: DEFAULT_BUFFER_SIZE,\n    };\n  }\n\n  if (!IsTextEncoderAvailable()) {\n    useEncodePolyfill();\n  }\n\n  if (finalOptions.enableNative) {\n    enableSyncToNative(getGlobalScope());\n    enableSyncToNative(getIsolationScope());\n  }\n\n  const browserOptions = {\n    ...finalOptions,\n    autoSessionTracking:\n      NATIVE.platform === 'web' && finalOptions.enableAutoSessionTracking,\n  } as BrowserOptions & T;\n\n  const mobileOptions = {\n    ...finalOptions,\n    enableAutoSessionTracking:\n      NATIVE.platform !== 'web' && finalOptions.enableAutoSessionTracking,\n  } as CapacitorClientOptions;\n\n  // We first initialize the NATIVE SDK to avoid the Javascript SDK to invoke any\n  // feature from the NATIVE SDK without the options being set.\n  // eslint-disable-next-line @typescript-eslint/no-floating-promises\n  void NATIVE.initNativeSdk(mobileOptions);\n  originalInit(browserOptions);\n}\n\n/**\n * Closes the SDK, stops sending events.\n */\nexport async function close(): Promise<void> {\n  try {\n    const client = getClient();\n\n    if (client) {\n      await client.close();\n      await NATIVE.closeNativeSdk();\n    }\n  } catch (e) {\n    logger.error('Failed to close the SDK');\n  }\n}\n\n/**\n * If native client is available it will trigger a native crash\n * Use this only for testing purposes\n */\nexport function nativeCrash(): void {\n  NATIVE.crash();\n}\n"]}